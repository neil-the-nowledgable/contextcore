{"version":3,"file":"module.js","mappings":"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","sources":["webpack://contextcore-datasource/external amd \"@grafana/ui\"","webpack://contextcore-datasource/external amd \"module\"","webpack://contextcore-datasource/external amd \"@grafana/runtime\"","webpack://contextcore-datasource/external amd \"@grafana/data\"","webpack://contextcore-datasource/external amd \"react\"","webpack://contextcore-datasource/webpack/bootstrap","webpack://contextcore-datasource/webpack/runtime/compat get default export","webpack://contextcore-datasource/webpack/runtime/define property getters","webpack://contextcore-datasource/webpack/runtime/hasOwnProperty shorthand","webpack://contextcore-datasource/webpack/runtime/make namespace object","webpack://contextcore-datasource/webpack/runtime/publicPath","webpack://contextcore-datasource/./node_modules/grafana-public-path.js","webpack://contextcore-datasource/./datasource.ts","webpack://contextcore-datasource/./components/ConfigEditor.tsx","webpack://contextcore-datasource/./types.ts","webpack://contextcore-datasource/./components/QueryEditor.tsx","webpack://contextcore-datasource/./module.ts"],"sourcesContent":["module.exports = __WEBPACK_EXTERNAL_MODULE__7__;","module.exports = __WEBPACK_EXTERNAL_MODULE__308__;","module.exports = __WEBPACK_EXTERNAL_MODULE__531__;","module.exports = __WEBPACK_EXTERNAL_MODULE__781__;","module.exports = __WEBPACK_EXTERNAL_MODULE__959__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"public/plugins/contextcore-datasource/\";","\nimport amdMetaModule from 'amd-module';\n\n__webpack_public_path__ =\n  amdMetaModule && amdMetaModule.uri\n    ? amdMetaModule.uri.slice(0, amdMetaModule.uri.lastIndexOf('/') + 1)\n    : 'public/plugins/contextcore-datasource/';\n","import {\n  DataSourceInstanceSettings,\n  DataQueryRequest,\n  DataQueryResponse,\n  DataSourceApi,\n  MutableDataFrame,\n  FieldType,\n} from '@grafana/data';\nimport { getBackendSrv } from '@grafana/runtime';\nimport { ContextCoreDataSourceOptions, ContextCoreQuery, WebhookResponse } from './types';\n\nexport class DataSource extends DataSourceApi<ContextCoreQuery, ContextCoreDataSourceOptions> {\n  baseUrl: string;\n\n  constructor(instanceSettings: DataSourceInstanceSettings<ContextCoreDataSourceOptions>) {\n    super(instanceSettings);\n    this.baseUrl = instanceSettings.jsonData.url || 'http://localhost:8080';\n  }\n\n  async query(options: DataQueryRequest<ContextCoreQuery>): Promise<DataQueryResponse> {\n    const promises = options.targets\n      .filter((target) => !target.hide && target.queryText?.trim())\n      .map(async (target) => {\n        const startTime = Date.now();\n\n        try {\n          const response = await getBackendSrv().fetch<WebhookResponse>({\n            url: `${this.baseUrl}/invoke`,\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            data: { prompt: target.queryText },\n          }).toPromise();\n\n          const data = response?.data;\n          const endTime = Date.now();\n\n          if (data?.success) {\n            return new MutableDataFrame({\n              refId: target.refId,\n              fields: [\n                { name: 'Time', type: FieldType.time, values: [endTime] },\n                { name: 'Prompt', type: FieldType.string, values: [target.queryText] },\n                { name: 'Response', type: FieldType.string, values: [data.response] },\n                { name: 'Tokens', type: FieldType.number, values: [data.metrics?.total_tokens || 0] },\n                { name: 'Response Time (ms)', type: FieldType.number, values: [data.metrics?.response_time_ms || (endTime - startTime)] },\n                { name: 'Model', type: FieldType.string, values: [data.model || 'unknown'] },\n              ],\n            });\n          } else {\n            return new MutableDataFrame({\n              refId: target.refId,\n              fields: [\n                { name: 'Time', type: FieldType.time, values: [endTime] },\n                { name: 'Error', type: FieldType.string, values: [data?.error || 'Unknown error'] },\n              ],\n            });\n          }\n        } catch (error) {\n          const errorMessage = error instanceof Error ? error.message : 'Request failed';\n          return new MutableDataFrame({\n            refId: target.refId,\n            fields: [\n              { name: 'Time', type: FieldType.time, values: [Date.now()] },\n              { name: 'Error', type: FieldType.string, values: [errorMessage] },\n            ],\n          });\n        }\n      });\n\n    return { data: await Promise.all(promises) };\n  }\n\n  async testDatasource(): Promise<{ status: string; message: string }> {\n    try {\n      const response = await getBackendSrv().fetch({\n        url: `${this.baseUrl}/health`,\n        method: 'GET',\n      }).toPromise();\n\n      if (response?.status === 200) {\n        return {\n          status: 'success',\n          message: 'Connection successful! Rabbit API server is running.',\n        };\n      }\n      return {\n        status: 'error',\n        message: `Unexpected response: HTTP ${response?.status}`,\n      };\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Connection failed';\n      return {\n        status: 'error',\n        message: `Cannot connect to Rabbit API: ${errorMessage}`,\n      };\n    }\n  }\n}\n","import React from 'react';\nimport { DataSourcePluginOptionsEditorProps } from '@grafana/data';\nimport { Input, InlineField, FieldSet } from '@grafana/ui';\nimport { ContextCoreDataSourceOptions, ContextCoreSecureJsonData } from '../types';\n\ntype Props = DataSourcePluginOptionsEditorProps<ContextCoreDataSourceOptions, ContextCoreSecureJsonData>;\n\nexport const ConfigEditor: React.FC<Props> = ({ options, onOptionsChange }) => {\n  const { jsonData } = options;\n\n  const onUrlChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    onOptionsChange({\n      ...options,\n      jsonData: {\n        ...jsonData,\n        url: event.target.value,\n      },\n    });\n  };\n\n  return (\n    <FieldSet label=\"Connection\">\n      <InlineField\n        label=\"Rabbit API URL\"\n        labelWidth={14}\n        tooltip=\"The base URL of the Rabbit API server (e.g., http://localhost:8080)\"\n      >\n        <Input\n          value={jsonData.url || ''}\n          onChange={onUrlChange}\n          placeholder=\"http://localhost:8080\"\n          width={40}\n        />\n      </InlineField>\n    </FieldSet>\n  );\n};\n","import { DataQuery, DataSourceJsonData } from '@grafana/data';\n\n/**\n * Query model for ContextCore datasource\n */\nexport interface ContextCoreQuery extends DataQuery {\n  /** The prompt text to send to Claude */\n  queryText: string;\n}\n\n/**\n * Default query values\n */\nexport const DEFAULT_QUERY: Partial<ContextCoreQuery> = {\n  queryText: '',\n};\n\n/**\n * Datasource configuration options\n */\nexport interface ContextCoreDataSourceOptions extends DataSourceJsonData {\n  /** Base URL of the Rabbit API server */\n  url?: string;\n}\n\n/**\n * Secure JSON data (not exposed to frontend)\n */\nexport interface ContextCoreSecureJsonData {\n  /** Optional API key for authentication */\n  apiKey?: string;\n}\n\n/**\n * Response from the Rabbit API invoke endpoint\n */\nexport interface WebhookResponse {\n  success: boolean;\n  response: string;\n  model?: string;\n  metrics?: {\n    response_time_ms: number;\n    input_tokens: number;\n    output_tokens: number;\n    total_tokens: number;\n    sdk?: string;\n  };\n  error?: string;\n}\n","import React from 'react';\nimport { QueryEditorProps } from '@grafana/data';\nimport { TextArea, InlineField, InlineFieldRow } from '@grafana/ui';\nimport { DataSource } from '../datasource';\nimport { ContextCoreDataSourceOptions, ContextCoreQuery, DEFAULT_QUERY } from '../types';\n\ntype Props = QueryEditorProps<DataSource, ContextCoreQuery, ContextCoreDataSourceOptions>;\n\nexport const QueryEditor: React.FC<Props> = ({ query, onChange, onRunQuery }) => {\n  const onQueryTextChange = (event: React.ChangeEvent<HTMLTextAreaElement>) => {\n    onChange({ ...query, queryText: event.target.value });\n  };\n\n  const onBlur = () => {\n    if (query.queryText?.trim()) {\n      onRunQuery();\n    }\n  };\n\n  const { queryText } = { ...DEFAULT_QUERY, ...query };\n\n  return (\n    <InlineFieldRow>\n      <InlineField label=\"Prompt\" labelWidth={10} grow>\n        <TextArea\n          value={queryText}\n          onChange={onQueryTextChange}\n          onBlur={onBlur}\n          placeholder=\"Enter your prompt for Claude...\"\n          rows={4}\n        />\n      </InlineField>\n    </InlineFieldRow>\n  );\n};\n","import { DataSourcePlugin } from '@grafana/data';\nimport { DataSource } from './datasource';\nimport { ConfigEditor } from './components/ConfigEditor';\nimport { QueryEditor } from './components/QueryEditor';\nimport { ContextCoreQuery, ContextCoreDataSourceOptions } from './types';\n\nexport const plugin = new DataSourcePlugin<DataSource, ContextCoreQuery, ContextCoreDataSourceOptions>(DataSource)\n  .setConfigEditor(ConfigEditor)\n  .setQueryEditor(QueryEditor);\n"],"names":["module","exports","__WEBPACK_EXTERNAL_MODULE__7__","__WEBPACK_EXTERNAL_MODULE__308__","__WEBPACK_EXTERNAL_MODULE__531__","__WEBPACK_EXTERNAL_MODULE__781__","__WEBPACK_EXTERNAL_MODULE__959__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","p","slice","lastIndexOf","DataSource","DataSourceApi","query","options","promises","targets","filter","target","hide","queryText","trim","map","startTime","Date","now","response","getBackendSrv","fetch","url","this","baseUrl","method","headers","data","prompt","toPromise","endTime","success","MutableDataFrame","refId","fields","name","type","FieldType","time","values","string","number","metrics","total_tokens","response_time_ms","model","error","errorMessage","Error","message","Promise","all","testDatasource","status","constructor","instanceSettings","super","jsonData","DEFAULT_QUERY","plugin","DataSourcePlugin","setConfigEditor","onOptionsChange","FieldSet","label","InlineField","labelWidth","tooltip","Input","onChange","event","placeholder","width","setQueryEditor","onRunQuery","InlineFieldRow","grow","TextArea","onBlur","rows"],"ignoreList":[],"sourceRoot":""}