/* [create-plugin] version: 6.7.8 */
/* [create-plugin] plugin: contextcore-datasource@1.0.0 */
define(["@grafana/ui","module","@grafana/runtime","@grafana/data","react"],(e,t,r,n,o)=>(()=>{"use strict";var a={7(t){t.exports=e},308(e){e.exports=t},531(e){e.exports=r},781(e){e.exports=n},959(e){e.exports=o}},i={};function l(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}};return a[e](r,r.exports,l),r.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var r in t)l.o(t,r)&&!l.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="public/plugins/contextcore-datasource/";var s={};l.r(s),l.d(s,{plugin:()=>D});var u=l(308),c=l.n(u);l.p=c()&&c().uri?c().uri.slice(0,c().uri.lastIndexOf("/")+1):"public/plugins/contextcore-datasource/";var p=l(781),d=l(531);function y(e,t,r,n,o,a,i){try{var l=e[a](i),s=l.value}catch(e){return void r(e)}l.done?t(s):Promise.resolve(s).then(n,o)}function b(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){y(a,n,o,i,l,"next",e)}function l(e){y(a,n,o,i,l,"throw",e)}i(void 0)})}}class f extends p.DataSourceApi{query(e){return b(function*(){const t=e.targets.filter(e=>{var t;return!e.hide&&(null===(t=e.queryText)||void 0===t?void 0:t.trim())}).map(e=>b(function*(){const t=Date.now();try{const o=yield(0,d.getBackendSrv)().fetch({url:`${this.baseUrl}/invoke`,method:"POST",headers:{"Content-Type":"application/json"},data:{prompt:e.queryText}}).toPromise(),a=null==o?void 0:o.data,i=Date.now();var r,n;return(null==a?void 0:a.success)?new p.MutableDataFrame({refId:e.refId,fields:[{name:"Time",type:p.FieldType.time,values:[i]},{name:"Prompt",type:p.FieldType.string,values:[e.queryText]},{name:"Response",type:p.FieldType.string,values:[a.response]},{name:"Tokens",type:p.FieldType.number,values:[(null===(r=a.metrics)||void 0===r?void 0:r.total_tokens)||0]},{name:"Response Time (ms)",type:p.FieldType.number,values:[(null===(n=a.metrics)||void 0===n?void 0:n.response_time_ms)||i-t]},{name:"Model",type:p.FieldType.string,values:[a.model||"unknown"]}]}):new p.MutableDataFrame({refId:e.refId,fields:[{name:"Time",type:p.FieldType.time,values:[i]},{name:"Error",type:p.FieldType.string,values:[(null==a?void 0:a.error)||"Unknown error"]}]})}catch(t){const r=t instanceof Error?t.message:"Request failed";return new p.MutableDataFrame({refId:e.refId,fields:[{name:"Time",type:p.FieldType.time,values:[Date.now()]},{name:"Error",type:p.FieldType.string,values:[r]}]})}}).call(this));return{data:yield Promise.all(t)}}).call(this)}testDatasource(){return b(function*(){try{const e=yield(0,d.getBackendSrv)().fetch({url:`${this.baseUrl}/health`,method:"GET"}).toPromise();return 200===(null==e?void 0:e.status)?{status:"success",message:"Connection successful! Rabbit API server is running."}:{status:"error",message:`Unexpected response: HTTP ${null==e?void 0:e.status}`}}catch(e){return{status:"error",message:`Cannot connect to Rabbit API: ${e instanceof Error?e.message:"Connection failed"}`}}}).call(this)}constructor(e){var t,r,n;super(e),n=void 0,(r="baseUrl")in(t=this)?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,this.baseUrl=e.jsonData.url||"http://localhost:8080"}}var m=l(959),v=l.n(m),g=l(7);function O(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){O(e,t,r[t])})}return e}function P(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}const j={queryText:""};function w(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){w(e,t,r[t])})}return e}function x(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}const D=new p.DataSourcePlugin(f).setConfigEditor(({options:e,onOptionsChange:t})=>{const{jsonData:r}=e;return v().createElement(g.FieldSet,{label:"Connection"},v().createElement(g.InlineField,{label:"Rabbit API URL",labelWidth:14,tooltip:"The base URL of the Rabbit API server (e.g., http://localhost:8080)"},v().createElement(g.Input,{value:r.url||"",onChange:n=>{t(P(h({},e),{jsonData:P(h({},r),{url:n.target.value})}))},placeholder:"http://localhost:8080",width:40})))}).setQueryEditor(({query:e,onChange:t,onRunQuery:r})=>{const{queryText:n}=T({},j,e);return v().createElement(g.InlineFieldRow,null,v().createElement(g.InlineField,{label:"Prompt",labelWidth:10,grow:!0},v().createElement(g.TextArea,{value:n,onChange:r=>{t(x(T({},e),{queryText:r.target.value}))},onBlur:()=>{var t;(null===(t=e.queryText)||void 0===t?void 0:t.trim())&&r()},placeholder:"Enter your prompt for Claude...",rows:4})))});return s})());
//# sourceMappingURL=module.js.map